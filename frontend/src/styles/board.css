/* src/styles/board.css */

/* ========== 页面 & 画布 ========== */

.iot-board {
    position: relative;
    width: 100vw;
    height: 100vh;
    box-sizing: border-box;
    overflow: hidden;
    background:
            radial-gradient(circle at top, var(--iot-color-bg-body) 0%, var(--iot-color-bg-body) 40%, var(--iot-color-bg-body) 100%);
    color: var(--iot-color-text);
    font-size: var(--iot-font-base);
}

/* 背景画布 */
.iot-board .canvas {
    position: absolute;
    inset: 0;
    overflow: auto;
    background-image:
            linear-gradient(90deg, var(--iot-color-grid) 1px, transparent 0),
            linear-gradient(180deg, var(--iot-color-grid) 1px, transparent 0);
    background-size: var(--iot-grid-size) var(--iot-grid-size);
    background-color: var(--iot-color-bg-canvas);
}

/* 画布内部使用百分比尺寸，方便缩放与平移 */
.iot-board .canvas-inner {
    position: relative;
    width: var(--iot-canvas-size);
    height: var(--iot-canvas-size);
    min-width: 100%;
    min-height: 100%;
}

.iot-board .edge-layer {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: visible;
}

.iot-board .edge-layer .edge-line {
    fill: none;                           /* 关键：自环 path 不要填充，否则就会出现“黑洞” */
    stroke: var(--iot-color-edge);
    stroke-width: 2;
    stroke-linecap: round;
}

.iot-board .edge-layer .edge-arrow {
    fill: var(--iot-color-edge);
}

/* ========== 节点 ========== */

.iot-board .device-node {
    position: absolute;
    background: radial-gradient(
            circle at top,
            var(--iot-color-node-highlight),
            var(--iot-color-node-bg)
    );
    border-radius: var(--iot-radius-node);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--iot-node-gap);
    cursor: grab;
    box-shadow:
            var(--iot-node-shadow),
            0 0 0 1px var(--iot-color-node-border);
    color: var(--iot-color-text);
    user-select: none;
}

.iot-board .device-node:active {
    cursor: grabbing;
}

.iot-board .device-img {
    pointer-events: none;
}

/* 文字本身的基础样式；字体大小由 JS 动态控制更灵活 */
.iot-board .device-label {
    font-weight: 600;
    text-align: center;
    padding: var(--iot-space-2xs) var(--iot-space-sm) var(--iot-space-sm);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--iot-color-title);
}

/* 缩放手柄：透明 + hover 时出现 */
.iot-board .resize-handle {
    position: absolute;
    width: var(--iot-resize-size);
    height: var(--iot-resize-size);
    border-radius: var(--iot-radius-resize);
    border: 1px solid var(--iot-color-resize-border);
    background: var(--iot-color-resize-bg);
    box-shadow: 0 0 0 1px var(--iot-color-resize-shadow);
    opacity: 0;
    transition: opacity 0.12s;
}

.iot-board .device-node:hover .resize-handle {
    opacity: 1;
}

.iot-board .resize-handle.tl {
    left: var(--iot-resize-offset);
    top: var(--iot-resize-offset);
    cursor: nw-resize;
}
.iot-board .resize-handle.tr {
    right: var(--iot-resize-offset);
    top: var(--iot-resize-offset);
    cursor: ne-resize;
}
.iot-board .resize-handle.bl {
    left: var(--iot-resize-offset);
    bottom: var(--iot-resize-offset);
    cursor: sw-resize;
}
.iot-board .resize-handle.br {
    right: var(--iot-resize-offset);
    bottom: var(--iot-resize-offset);
    cursor: se-resize;
}

/* ========== 浮动卡片通用样式 ========== */

.iot-board .floating-card {
    position: absolute;
    background: linear-gradient(
            145deg,
            var(--iot-color-card-bg),
            var(--iot-color-card-bg-strong)
    );
    border-radius: var(--iot-radius-card);
    box-shadow:
            var(--iot-color-card-shadow),
            0 0 0 1px var(--iot-color-card-border);
    backdrop-filter: blur(18px);
    color: var(--iot-color-text);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    font-size: var(--iot-font-base);
    max-height: calc(100vh - 4rem);  /* 4rem≈上下各 2rem 的空隙 */
}


/* 左侧 InputPanel / 状态卡片统一宽度 */
.iot-board .input-card,
.iot-board .status-card {
    width: clamp(
            var(--iot-card-width-min),
            var(--iot-card-width),
            var(--iot-card-width-max)
    );
}

/* 头部 */
.iot-board .card-header {
    padding: var(--iot-space-sm) var(--iot-space-md);
    display: flex;
    align-items: center;
    gap: var(--iot-space-sm);
    border-bottom: 1px solid var(--iot-color-card-border);
    cursor: move;
    background: radial-gradient(
            circle at top left,
            var(--iot-color-card-header-glow),
            transparent 60%
    );
}

.iot-board .card-title {
    font-weight: 600;
    font-size: var(--iot-font-title);
    flex: 1;
    color: var(--iot-color-title);
}

.iot-board .card-subtitle {
    font-size: var(--iot-font-subtitle);
    font-weight: 500;
    color: var(--iot-color-subtitle);
}

.iot-board .card-header-actions {
    display: flex;
    align-items: center;
    gap: var(--iot-space-2xs);
}

.iot-board .card-body {
    padding: var(--iot-space-md) var(--iot-space-md) var(--iot-space-lg);
    flex: 1 1 auto;     /* 占据剩余空间 */
    min-height: 0;      /* 与 flex 配合防止撑开 */
    overflow-y: auto;   /* 内容超出时出现内部滚动条 */
}

/* 折叠面板统一样式 */
.iot-board .panel-collapse {
    --el-collapse-header-bg-color: transparent;
    --el-collapse-content-bg-color: transparent;
    font-size: var(--iot-font-base);
}

.iot-board .collapse-title-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex: 1;
    min-width: 0;
}

/* ========== 让 InputPanel 内所有容器背景透明，露出卡片/画布 ========== */

.iot-board .input-card .card-body {
    background-color: transparent;
}

.iot-board .input-card :deep(.panel-collapse),
.iot-board .input-card :deep(.el-collapse),
.iot-board .input-card :deep(.el-collapse-item__wrap),
.iot-board .input-card :deep(.el-collapse-item__content),
.iot-board .input-card :deep(.el-scrollbar__wrap),
.iot-board .input-card :deep(.el-scrollbar__view),
.iot-board .input-card :deep(.el-form),
.iot-board .input-card :deep(.el-form-item) {
    background-color: transparent !important;
    box-shadow: none;
}

.iot-board .input-card :deep(.el-divider) {
    border-color: var(--iot-color-divider);
}

/* ========== Devices 区域 ========== */

.iot-board .device-search {
    margin-bottom: var(--iot-space-sm);
}

.iot-board .device-item {
    background: var(--iot-color-device-item-bg);
    border-radius: var(--iot-radius-input);
    margin-bottom: var(--iot-space-sm);
    padding: var(--iot-space-sm) var(--iot-space-md);
    cursor: grab;
    transition:
            box-shadow 0.14s ease-out,
            background 0.14s ease-out,
            transform 0.12s ease-out;
    border: 1px solid var(--iot-color-device-item-border);
    color: var(--iot-color-device-item-text);
    font-size: var(--iot-font-subtitle);
}

.iot-board .device-item:hover {
    background: var(--iot-color-device-item-bg-hover);
    box-shadow: var(--iot-shadow-device-hover);
    transform: translateY(-1px);
}

/* 图标模式 */
.iot-board .device-icon-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(6.25rem, 1fr)); /* 100px */
    gap: var(--iot-space-sm);
}

.iot-board .device-item--icon {
    text-align: center;
}

.iot-board .device-thumb {
    width: var(--iot-thumb-width);
    height: var(--iot-thumb-height);
    object-fit: contain;
    margin-bottom: var(--iot-space-2xs);
}

.iot-board .device-thumb-label {
    font-size: var(--iot-font-caption);
    word-break: break-all;
}
/* ========== 规约区域样式 ========== */

.iot-board .spec-form {
    margin-top: var(--iot-space-2xs);
    margin-bottom: var(--iot-space-sm);
}

.iot-board .spec-section {
    margin: var(--iot-space-sm) 0 var(--iot-space-xs);
    padding: var(--iot-space-sm);
    border-radius: var(--iot-radius-input);
    background: linear-gradient(
            135deg,
            var(--iot-color-spec-bg),
            var(--iot-color-spec-bg-strong)
    );
    box-shadow: 0 0 0 1px var(--iot-color-spec-border);
}

.iot-board .spec-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--iot-space-xs);
}

.iot-board .spec-section-title {
    font-size: var(--iot-font-caption);
    font-weight: 600;
    color: var(--iot-color-text-muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
}

.iot-board .spec-section-group {
    display: flex;
    flex-direction: column;
    gap: var(--iot-space-xs);
}

.iot-board .spec-condition-row {
    display: flex;
    align-items: center;
    gap: var(--iot-space-xs);
}

.iot-board .spec-add-button {
    margin-top: var(--iot-space-sm); /* 0.5rem ≈ 8px */
}

.iot-board .spec-cond-device,
.iot-board .spec-cond-target,
.iot-board .spec-cond-relation,
.iot-board .spec-cond-value {
    min-width: 5.625rem; /* 90px */
}

.iot-board .spec-cond-device {
    flex: 1.1;
}

.iot-board .spec-cond-target {
    flex: 1;
}

.iot-board .spec-cond-relation {
    flex: 0.8;
}

.iot-board .spec-cond-value {
    flex: 1;
}

.iot-board .spec-then-text {
    font-size: var(--iot-font-caption);
    color: var(--iot-color-text-muted);
}

/* ========== Element Plus 深色覆盖：输入 / 选择 / 表单 ========== */

.iot-board .floating-card :deep(.el-input__wrapper),
.iot-board .floating-card :deep(.el-select__wrapper) {
    background-color: var(--iot-color-input-bg);
    box-shadow: 0 0 0 1px var(--iot-color-input-border);
    border-radius: var(--iot-radius-input);
}

.iot-board .floating-card :deep(.el-textarea__inner) {
    background-color: var(--iot-color-input-bg);
    border: 1px solid var(--iot-color-input-border-strong);
    border-radius: var(--iot-radius-input);
    color: var(--iot-color-text);
    font-size: var(--iot-font-base);
}

.iot-board .floating-card :deep(.el-input__inner),
.iot-board .floating-card :deep(.el-select__placeholder),
.iot-board .floating-card :deep(.el-select__selected-item) {
    color: var(--iot-color-text);
    font-size: var(--iot-font-base);
}

.iot-board .floating-card :deep(.el-form-item__label) {
    color: var(--iot-color-text-muted);
    font-size: var(--iot-font-base);
}

.iot-board .floating-card :deep(.el-form-item) {
    margin-bottom: 0.875rem;
}

/* ========== Status 卡片里的表格 ========== */

.iot-board .status-card .el-table {
    --el-table-bg-color: transparent;
    --el-table-tr-bg-color: transparent;
    --el-table-header-bg-color: transparent;
    --el-table-border-color: var(--iot-color-table-border);
    color: var(--iot-color-text);
    background-color: transparent;
    font-size: var(--iot-font-base);
}

.iot-board .status-card .el-table th,
.iot-board .status-card .el-table td {
    background-color: transparent !important;
}

.iot-board .status-card .el-table th .cell {
    color: var(--iot-color-text-muted);
    font-weight: 500;
}

/* 单元格：不换行 + 溢出省略号 */
.iot-board .status-card .el-table .cell {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* 悬停高亮统一样式：柔和一点的蓝色 */
.iot-board .status-card .el-table__row:hover > td,
.iot-board .floating-card :deep(.el-table__row:hover > td) {
    background-color: var(--iot-color-table-row-hover) !important;
}

/* ========== 设备信息弹窗 ========== */

.iot-board :deep(.device-dialog-footer) {
    display: flex;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    gap: var(--iot-space-sm);
}

